@page
@model IDI.Digiccy.Transaction.Client.Pages.BTCUSDTModel
@{
    ViewData["Title"] = "BTCUSDT";
}

<h2>BTC/USDT</h2>

<div id="app" class="container">
    <div class="row">
        <div class="col-xs-6">
            <div class="panel panel-default">
                <div class="panel-heading">Bid</div>
                <div class="panel-body">
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">USDT</div>
                            <input id="bid_price" type="number" class="form-control" v-model="bid.price" placeholder="Price">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">&nbsp;HSR&nbsp;</div>
                            <input id="bid_volume" type="number" class="form-control" v-model="bid.volume" placeholder="Volume">
                        </div>
                    </div>
                    <button id="btnBid" type="submit" class="btn btn-danger btn-block" v-on:click="onBid">Bid</button>
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="panel panel-default">
                <div class="panel-heading">Ask</div>
                <div class="panel-body">
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">USDT</div>
                            <input id="ask_price" type="number" class="form-control" v-model="ask.price" placeholder="Price">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-addon">&nbsp;HSR&nbsp;</div>
                            <input id="ask_volume" type="number" class="form-control" v-model="ask.volume" placeholder="Volume">
                        </div>
                    </div>
                    <button id="btnAsk" type="submit" class="btn btn-success btn-block" v-on:click="onAsk">Ask</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        var app = new Vue({
            el: '#app',
            data: {
                info: { price: 0.00, open: 0.0, high: 0.0, low: 0.0, rate: 0.00, volume: 0.0, trend: 0 },
                asks: [],
                bids: [],
                trades: [],
                bid: { price: 10, volume: 10 },
                ask: { price: 10, volume: 10 },
                polling:false
            },
            created: function () {
                this.onPull();
            },
            methods: {
                onPull: function () {
                    var self = this;
                    setInterval(function () {
                        if (self.polling)
                            return;

                        $.ajax({
                            type: "get", datatype: "json",
                            url: "http://localhost:17528/api/trans/info",
                            beforeSend: function () {
                                self.polling = true;
                            },
                            success: function (result) {
                                self.polling = false;
                                console.log(result);
                            },
                            error: function (result) {
                                self.polling = false;
                            }
                        });
                    }, 3000);
                },
                onBid: function () {
                    var self = this;

                    $.ajax({
                        type: "post",
                        crossDomain: true,
                        url: "http://localhost:17528/api/trans/trade",
                        data: JSON.stringify({ uid: 10001, tran_type: 1, price: self.bid.price, size: self.bid.volume }),
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        beforeSend: function () {
                            $("#btnBid").attr("disabled","disabled");
                        },
                        complete: function () {
                            $("#btnBid").removeAttr("disabled");
                        },
                        success: function (result) {
                            $("#btnBid").removeAttr("disabled");
                            alert(result.message);
                        }
                    });
                },
                onAsk: function () {
                    var self = this;

                    $.ajax({
                        type: "post",
                        crossDomain: true,
                        url: "http://localhost:17527/api/trans/trade",
                        data: JSON.stringify({ uid: 10002, tran_type: 0, price: self.ask.price, size: self.ask.volume }),
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        beforeSend: function () {
                            $("#btnAsk").attr("disabled", "disabled");
                        },
                        complete: function () {
                            $("#btnAsk").removeAttr("disabled");
                        },
                        success: function (result) {
                            $("#btnAsk").removeAttr("disabled");
                            alert(result.message);
                        }
                    });
                }
            },
        });
    </script>
}




